"use strict";(self["webpackChunkhm_toutiao"]=self["webpackChunkhm_toutiao"]||[]).push([[212],{2212:function(t,e,a){a.r(e),a.d(e,{default:function(){return U}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[e("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",size:"small",round:"",icon:"search",to:"/search"},slot:"title"},[t._v("搜索")])],1),e("van-tabs",{staticClass:"channel-tabs",attrs:{swipeable:"",animated:"",border:""},scopedSlots:t._u([{key:"nav-right",fn:function(){return[e("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),e("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isEdit=!0}},slot:"nav-right"},[e("i",{staticClass:"toutiao toutiao-gengduo"})])]},proxy:!0}]),model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.channels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("ArticleList",{attrs:{channel:t}})],1)})),1),e("van-popup",{style:{height:"100%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.isEdit,callback:function(e){t.isEdit=e},expression:"isEdit"}},[e("channel-edit",{attrs:{myChannels:t.channels,activeIndex:t.active},on:{changeChannel:t.changeChannel,delChannel:t.delChannel}})],1)],1)},i=[],n=a(4471);const l=()=>(0,n.Z)({url:"/v1_0/user/channels"}),c=t=>(0,n.Z)({url:"/v1_0/articles",params:t}),r=()=>(0,n.Z)({url:"/v1_0/channels"}),o=t=>(0,n.Z)({url:"/v1_0/user/channels",method:"patch",data:t}),h=t=>(0,n.Z)({url:"/v1_0/user/channels/"+t,method:"delete"});var d=a(7247),u=function(){var t=this,e=t._self._c;return e("div",[e("van-pull-refresh",{attrs:{"success-text":t.successText},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,a){return e("ArticleItem",{key:a,attrs:{articleItem:t}})})),1)],1)],1)},m=[],v=function(){var t=this,e=t._self._c;return e("div",[e("van-cell",{staticClass:"article-item",attrs:{to:"/article/"+t.articleItem.art_id},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"title van-multi-ellipsis--l2"},[t._v(" "+t._s(t.articleItem.title)+" ")])]},proxy:!0},{key:"label",fn:function(){return[e("div",{attrs:{slot:""},slot:"default"},[3===t.articleItem.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.articleItem.cover.images,(function(t,a){return e("div",{key:a,staticClass:"cover-item"},[e("van-image",{staticClass:"cover-item-img",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),e("div",{staticClass:"label-info-wrap"},[e("span",[t._v(t._s(t.articleItem.aut_name))]),e("span",[t._v(t._s(t.articleItem.comm_count)+"评论")]),e("span",[t._v(t._s(t._f("relativeTime")(t.articleItem.pubdate)))])])])]},proxy:!0}])},[1===t.articleItem.cover.type?e("van-image",{staticClass:"right-cover",attrs:{slot:"default",fit:"cover",src:t.articleItem.cover.images[0]},slot:"default"}):t._e()],1)],1)},p=[],f={name:"ArticleItem",props:{articleItem:{type:Object,required:!0}}},C=f,g=a(1001),_=(0,g.Z)(C,v,p,!1,null,"08a67bc5",null),y=_.exports,b={name:"ArticleList",props:{channel:{type:Object,required:!0}},components:{ArticleItem:y},data(){return{list:[],loading:!1,finished:!1,error:!1,isLoading:!1,successText:"",timestamp:Date.now()}},methods:{async onLoad(){try{const{data:t}=await c({channel_id:this.channel.id,timestamp:this.timestamp});if(this.loading=!1,this.list.push(...t.data.results),!t.data.pre_timestamp)return this.finished=!0;this.timestamp=t.data.pre_timestamp}catch(t){console.log(t),this.error=!0}},async onRefresh(){try{const{data:t}=await c({channel_id:this.channel.id,timestamp:Date.now()});this.isLoading=!1,this.list.unshift(...t.data.results),this.successText=`成功更新了${t.data.results.length}条数据`}catch(t){console.log(t)}}}},x=b,k=(0,g.Z)(x,u,m,!1,null,null,null),I=k.exports,w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),e("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:function(e){t.isEditShow=!t.isEditShow}}},[t._v(t._s(t.isEditShow?"完成":"编辑"))])],1),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels,(function(a,s){return e("van-grid-item",{key:a.id,staticClass:"grid-item",on:{click:function(e){return t.clickSwitch(a,s)}}},[t.isEditShow&&t.activeIndex!==s?e("van-icon",{attrs:{slot:"icon",name:"clear"},slot:"icon"}):t._e(),e("span",{staticClass:"text",class:{active:t.activeIndex===s},attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))])],1)})),1),e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("频道推荐")])]),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommendChannels,(function(a){return e("van-grid-item",{key:a.id,staticClass:"grid-item",attrs:{icon:"plus",text:a.name},on:{click:function(e){return t.addChannel(a)}}})})),1)],1)},E=[],S=a(3822),L={name:"ChannelEdit",components:{},props:{myChannels:{type:Array,required:!0},activeIndex:{type:Number,required:!0}},data(){return{allChannels:[],isEditShow:!1}},computed:{...(0,S.Se)(["token"]),recommendChannels(){return this.allChannels.filter((t=>this.myChannels.every((e=>e.id!==t.id))))}},created(){this.initData()},methods:{async initData(){try{const{data:t}=await r();this.allChannels=t.data.channels}catch(t){console.log(t)}},async addChannel(t){if(console.log(t),this.myChannels.push(t),this.token)try{await o({channels:[{id:t.id,seq:this.myChannels.length-1}]})}catch(e){console.log(e),this.$toast.fail("数据线上同步失败！")}else console.log(t),(0,d.LS)("TOUTIAO-USER-CHANNELS",this.myChannels)},clickSwitch(t,e){this.isEditShow?(e<=this.activeIndex&&this.$emit("delChannel",this.activeIndex-1),this.myChannels.splice(e,1),this.delChannel(t.id)):this.$emit("changeChannel",e)},async delChannel(t){if(this.token)try{await h(t)}catch(e){console.log(e),this.$toast.fail("数据线上同步失败！")}else(0,d.LS)("TOUTIAO-USER-CHANNELS",this.myChannels)}}},A=L,T=(0,g.Z)(A,w,E,!1,null,"c119d538",null),Z=T.exports,O={name:"Home",components:{ArticleList:I,ChannelEdit:Z},data(){return{active:0,channels:[],isEdit:!1}},created(){this.initData()},methods:{async initData(){if(this.$store.getters.token)try{const{data:t}=await l();this.channels=t.data.channels}catch(t){console.log(t)}else{const e=(0,d.rV)("TOUTIAO-USER-CHANNELS");if(console.log(e),e)this.channels=e;else try{const{data:t}=await l();this.channels=t.data.channels}catch(t){console.log(t)}}},changeChannel(t){this.active=t,this.isEdit=!1},delChannel(t){this.active=t}}},N=O,D=(0,g.Z)(N,s,i,!1,null,"98dd63b4",null),U=D.exports}}]);