"use strict";(self["webpackChunkhm_toutiao"]=self["webpackChunkhm_toutiao"]||[]).push([[808],{1808:function(t,e,s){s.r(e),s.d(e,{default:function(){return E}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-container"},[e("van-search",{attrs:{"show-action":"",shape:"round",placeholder:"请输入搜索关键词",background:"#3296fa"},on:{focus:function(e){t.isResultsShow=!1},search:t.onSearch,cancel:t.onCancel},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),t.isResultsShow?e("search-result",{attrs:{searchText:t.searchText}}):t.searchText?e("search-suggestion",{attrs:{searchText:t.searchText},on:{search:t.onSearch}}):e("search-history",{attrs:{searchHistories:t.searchHistories},on:{search:t.onSearch}})],1)},i=[],r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-result"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{title:t.title}})})),1)],1)},n=[],c=s(4471);const o=t=>(0,c.Z)({url:"/v1_0/suggestion",params:t}),h=t=>(0,c.Z)({url:"/v1_0/search",params:t});var l={name:"SearchResult",components:{},props:{searchText:{type:String,required:!0}},data(){return{list:[],loading:!1,finished:!1,page:1,per_page:10}},computed:{},watch:{},created(){this.initData()},mounted(){},methods:{async initData(){try{const{data:t}=await h({page:this.page,per_page:this.per_page,q:this.searchText});this.list=t.data.results}catch(t){console.log(t)}},async onLoad(){try{this.page++;const{data:t}=await h({page:this.page,per_page:this.per_page,q:this.searchText});if(this.loading=!1,t.data.results.length<this.per_page)return this.finished=!0;this.list.push(...t.data.results)}catch(t){console.log(t)}}}},u=l,d=s(1001),p=(0,d.Z)(u,r,n,!1,null,"ad6cc468",null),g=p.exports,f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-history"},[e("van-cell",{attrs:{title:"搜索历史"}},[!0===t.isEdit?[e("span",{on:{click:function(e){return t.searchHistories.splice(0)}}},[t._v("全部删除")]),e("span",{on:{click:function(e){t.isEdit=!1}}},[t._v("完成")])]:e("van-icon",{attrs:{name:"delete"},on:{click:function(e){t.isEdit=!0}}})],2),t._l(t.searchHistories,(function(s,a){return e("van-cell",{key:a,attrs:{title:s},on:{click:function(e){return t.clickHandler(s,a)}}},[e("van-icon",{attrs:{name:"close"}})],1)}))],2)},m=[],T={name:"SearchHistory",components:{},props:{searchHistories:{type:Array,required:!0}},data(){return{isEdit:!1}},computed:{},watch:{},created(){},mounted(){},methods:{clickHandler(t,e){this.isEdit?this.searchHistories.splice(e,1):this.$emit("search",t)}}},x=T,S=(0,d.Z)(x,f,m,!1,null,"4afd32c0",null),_=S.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-suggestion"},t._l(t.list,(function(s,a){return e("van-cell",{key:a,attrs:{icon:"search"},on:{click:function(e){return t.$emit("search",s)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{domProps:{innerHTML:t._s(t.highLight(s))}})]},proxy:!0}],null,!0)})})),1)},y=[],k={name:"SearchSuggestion",components:{},props:{searchText:{type:String,required:!0}},data(){return{list:[],timer:null}},computed:{},watch:{searchText:{immediate:!0,handler(){this.timer?(clearTimeout(this.timer),this.timer=null):this.timer=setTimeout((()=>{this.initData()}),500)}}},created(){},mounted(){},methods:{async initData(){try{const{data:t}=await o({q:this.searchText});1===t.data.options.length&&null===t.data.options[0]?this.list=[]:this.list=t.data.options}catch(t){console.log(t)}},highLight(t){const e=new RegExp(this.searchText,"gi");return t.replace(e,`<span style='color:red'>${this.searchText}</span>`)}}},H=k,w=(0,d.Z)(H,v,y,!1,null,"efb629f6",null),R=w.exports,C=s(7247),L={name:"Search",components:{SearchResult:g,SearchHistory:_,SearchSuggestion:R},data(){return{searchText:"",isResultsShow:!1,searchHistories:(0,C.rV)("TOUTIAO-HISTORY-LIST")||[]}},mounted(){},methods:{onSearch(t){this.isResultsShow=!0,this.searchText=t,this.searchHistories.unshift(t);const e=new Set(this.searchHistories);this.searchHistories=Array.from(e),(0,C.LS)("TOUTIAO-HISTORY-LIST",this.searchHistories)},onCancel(){this.$router.back()}}},b=L,q=(0,d.Z)(b,a,i,!1,null,"329457f8",null),E=q.exports}}]);